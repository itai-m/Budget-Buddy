{% extends "master_page.html" %}

{% block head %}
    {{block.super}}
    <link href="../static/css/budgets.css" rel="stylesheet" type="text/css"/>
    <link href="../static/css/budget.css" rel="stylesheet" type="text/css"/>
{%endblock%}

{% block content %}

    <table class="flatTable">
        <tr class="titleTr">
            <td class="titleTd"><h3>Budget: {{ budget.budgetName }}</h3></td>
            <td colspan="6"></td>
        </tr>
        <tr class="headingTr">
            <td>Description</td>
            <td>Amount</td>
            <td>Tag</td>
            <td>Added By</td>
            <td>Date</td>
            <td>Actions</td>
        </tr>
        {% for entry in budget.entryList %}
            <tr>
                <td>{{ entry|getEntryDescriptionByKey }}</td>
                <td>{{ entry|getEntryAmountByKey }} NIS</td>
                <td>{{ entry|getEntryTagDescriptionByKey }}</td>
                <td>{{ entry|getEntryAddedByByKey }}</td>
                <td>{{ entry|getEntryCreationDateByKey }}</td>
                <td class="controlTd">
                    <div class="settingsIcons">
                        {% if entry|getEntryAddedByByKey == userName or budget|getMyPermission:userName == "Manager" %}
                            <span class="settingsIcon"><i class="fa fa-cog"></i></span>
                            <span class="settingsIcon"><i class="fa fa-times"></i></span>
                            <a href="/EditEntry/{{ entry.id }}"><div class="settingsIcon"><i class="fa fa-pencil"></i></div></a>
                        {% endif %}
                    </div>
                </td>

            </tr>
        {% endfor %}
    </table>
    <br>
    <center><a href="../AddEntry/{{ budgetId }}" class="myButton">Add New Entry</a></center>


    <br>
    <center><span id="statistics"><h2>Statistics</h2></span></center>
    <script type="text/javascript" src="https://www.google.com/jsapi">

    </script>
    <script type="text/javascript">
        var tagsPieDic = [{{ budget|getTagPieDic|safe }}];
        var usersPieDic= [{{ budget|getUsersPieDic|safe }}];
        google.load("visualization", "1", {packages:["corechart"]});
        google.setOnLoadCallback(drawChart);
        function drawChart()
        {
            var data_tags = new google.visualization.DataTable();
	      	data_tags.addColumn('string', 'Tags');
            data_tags.addColumn('number', 'Total Amount');
	     	var f,n;

	        for(var i = 0 ; i<tagPieDic.length;i++)
            {
	        	f = String(Object.keys(tagsPieDic[i]))
                n =  tagsPieDic[i][f]
	        	data_tags.addRows([[f,n]])
	        }

            var data_users = new google.visualization.DataTable();
	      	data_users.addColumn('string', 'User');
            data_users.addColumn('number', 'Total Amount');
            for(var i = 0 ; i<usersPieDic.length;i++)
            {
	        	f = String(Object.keys(usersPieDic[i]))
                n =  usersPieDic[i][f]
	        	data_users.addRows([[f,n]])
	        }

            var options_tags = {
                title: 'Amount by tags'
            };
            var options_users = {
                title: 'Amount by users'
            };

            var chart_tags = new google.visualization.PieChart(document.getElementById('piechart_tags'));
            var chart_users = new google.visualization.PieChart(document.getElementById('piechart_users'));

            chart_tags.draw(data_tags, options_tags);
            chart_users.draw(data_users, options_users);
        }
    </script>
    </head>
    <div i="piechart_parent">
        <div id="piechart_tags"></div>
        <div id="piechart_users"></div>
    </div>

    <script src='http://codepen.io/assets/libs/fullpage/jquery.js'></script>
    <script src="../static/js/budgets.js"></script>

{%endblock%}